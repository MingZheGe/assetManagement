{"version":3,"file":"jsmind.screenshot.js","sources":["../src/plugins/jsmind.screenshot.js"],"sourcesContent":["/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nif (!jsMind) {\n    throw new Error('jsMind is not defined');\n}\n\nconst $ = jsMind.$;\n\nvar css = function (cStyle, property_name) {\n    return cStyle.getPropertyValue(property_name);\n};\nvar is_visible = function (cStyle) {\n    var visibility = css(cStyle, 'visibility');\n    var display = css(cStyle, 'display');\n    return visibility !== 'hidden' && display !== 'none';\n};\nvar jcanvas = {};\njcanvas.rect = function (ctx, x, y, w, h, r) {\n    if (w < 2 * r) r = w / 2;\n    if (h < 2 * r) r = h / 2;\n    ctx.moveTo(x + r, y);\n    ctx.arcTo(x + w, y, x + w, y + h, r);\n    ctx.arcTo(x + w, y + h, x, y + h, r);\n    ctx.arcTo(x, y + h, x, y, r);\n    ctx.arcTo(x, y, x + w, y, r);\n};\n\njcanvas.text_multiline = function (ctx, text, x, y, w, h, lineheight) {\n    var line = '';\n    var text_len = text.length;\n    var chars = text.split('');\n    var test_line = null;\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    for (var i = 0; i < text_len; i++) {\n        test_line = line + chars[i];\n        if (ctx.measureText(test_line).width > w && i > 0) {\n            ctx.fillText(line, x, y);\n            line = chars[i];\n            y += lineheight;\n        } else {\n            line = test_line;\n        }\n    }\n    ctx.fillText(line, x, y);\n};\n\njcanvas.text_ellipsis = function (ctx, text, x, y, w, h) {\n    var center_y = y + h / 2;\n    var text = jcanvas.fittingString(ctx, text, w);\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(text, x, center_y, w);\n};\n\njcanvas.fittingString = function (ctx, text, max_width) {\n    var width = ctx.measureText(text).width;\n    var ellipsis = 'â€¦';\n    var ellipsis_width = ctx.measureText(ellipsis).width;\n    if (width <= max_width || width <= ellipsis_width) {\n        return text;\n    } else {\n        var len = text.length;\n        while (width >= max_width - ellipsis_width && len-- > 0) {\n            text = text.substring(0, len);\n            width = ctx.measureText(text).width;\n        }\n        return text + ellipsis;\n    }\n};\n\njcanvas.image = function (ctx, url, x, y, w, h, r, rotation, callback) {\n    var img = new Image();\n    img.onload = function () {\n        ctx.save();\n        ctx.translate(x, y);\n        ctx.save();\n        ctx.beginPath();\n        jcanvas.rect(ctx, 0, 0, w, h, r);\n        ctx.closePath();\n        ctx.clip();\n        ctx.translate(w / 2, h / 2);\n        ctx.rotate((rotation * Math.PI) / 180);\n        ctx.drawImage(img, -w / 2, -h / 2);\n        ctx.restore();\n        ctx.restore();\n        !!callback && callback();\n    };\n    img.src = url;\n};\n\nclass screenshot {\n    constructor(jm) {\n        this.version = '0.1.0';\n        this.jm = jm;\n        this.canvas_elem = null;\n        this.canvas_ctx = null;\n        this._inited = false;\n    }\n    init() {\n        if (this._inited) {\n            return;\n        }\n        console.log('init');\n        var c = $.c('canvas');\n        var ctx = c.getContext('2d');\n\n        this.canvas_elem = c;\n        this.canvas_ctx = ctx;\n        this.jm.view.e_panel.appendChild(c);\n        this._inited = true;\n        this.resize();\n    }\n    shoot(callback) {\n        this.init();\n        this._draw(\n            function () {\n                !!callback && callback();\n                this.clean();\n            }.bind(this)\n        );\n        this._watermark();\n    }\n    shootDownload() {\n        this.shoot(\n            function () {\n                this._download();\n            }.bind(this)\n        );\n    }\n    shootAsDataURL(callback) {\n        this.shoot(\n            function () {\n                !!callback && callback(this.canvas_elem.toDataURL());\n            }.bind(this)\n        );\n    }\n    resize() {\n        if (this._inited) {\n            this.canvas_elem.width = this.jm.view.size.w;\n            this.canvas_elem.height = this.jm.view.size.h;\n        }\n    }\n    clean() {\n        var c = this.canvas_elem;\n        this.canvas_ctx.clearRect(0, 0, c.width, c.height);\n    }\n    _draw(callback) {\n        var ctx = this.canvas_ctx;\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'top';\n        this._draw_lines(\n            function () {\n                this._draw_nodes(callback);\n            }.bind(this)\n        );\n    }\n    _watermark() {\n        var c = this.canvas_elem;\n        var ctx = this.canvas_ctx;\n        ctx.textAlign = 'right';\n        ctx.textBaseline = 'bottom';\n        ctx.fillStyle = '#000';\n        ctx.font = '11px Verdana,Arial,Helvetica,sans-serif';\n        ctx.fillText('github.com/hizzgdev/jsmind', c.width - 5.5, c.height - 2.5);\n        ctx.textAlign = 'left';\n        ctx.fillText($.w.location, 5.5, c.height - 2.5);\n    }\n    _draw_lines(callback) {\n        this.jm.view.graph.copy_to(this.canvas_ctx, callback);\n    }\n    _draw_nodes(callback) {\n        var nodes = this.jm.mind.nodes;\n        var node;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            this._draw_node(node);\n        }\n\n        function check_nodes_ready() {\n            console.log('check_node_ready' + new Date());\n            var allOk = true;\n            for (var nodeid in nodes) {\n                node = nodes[nodeid];\n                allOk = allOk & node.ready;\n            }\n\n            if (!allOk) {\n                $.w.setTimeout(check_nodes_ready, 200);\n            } else {\n                $.w.setTimeout(callback, 200);\n            }\n        }\n        check_nodes_ready();\n    }\n    _draw_node(node) {\n        var ctx = this.canvas_ctx;\n        var view_data = node._data.view;\n        var node_element = view_data.element;\n        var ncs = getComputedStyle(node_element);\n        if (!is_visible(ncs)) {\n            node.ready = true;\n            return;\n        }\n\n        var bgcolor = css(ncs, 'background-color');\n        var round_radius = parseInt(css(ncs, 'border-top-left-radius'));\n        var color = css(ncs, 'color');\n        var padding_left = parseInt(css(ncs, 'padding-left'));\n        var padding_right = parseInt(css(ncs, 'padding-right'));\n        var padding_top = parseInt(css(ncs, 'padding-top'));\n        var padding_bottom = parseInt(css(ncs, 'padding-bottom'));\n        var text_overflow = css(ncs, 'text-overflow');\n        var font =\n            css(ncs, 'font-style') +\n            ' ' +\n            css(ncs, 'font-variant') +\n            ' ' +\n            css(ncs, 'font-weight') +\n            ' ' +\n            css(ncs, 'font-size') +\n            '/' +\n            css(ncs, 'line-height') +\n            ' ' +\n            css(ncs, 'font-family');\n\n        var rb = {\n            x: view_data.abs_x,\n            y: view_data.abs_y,\n            w: view_data.width + 1,\n            h: view_data.height + 1,\n        };\n        var tb = {\n            x: rb.x + padding_left,\n            y: rb.y + padding_top,\n            w: rb.w - padding_left - padding_right,\n            h: rb.h - padding_top - padding_bottom,\n        };\n\n        ctx.font = font;\n        ctx.fillStyle = bgcolor;\n        ctx.beginPath();\n        jcanvas.rect(ctx, rb.x, rb.y, rb.w, rb.h, round_radius);\n        ctx.closePath();\n        ctx.fill();\n\n        ctx.fillStyle = color;\n        if ('background-image' in node.data) {\n            var backgroundUrl = css(ncs, 'background-image').slice(5, -2);\n            node.ready = false;\n            var rotation = 0;\n            if ('background-rotation' in node.data) {\n                rotation = node.data['background-rotation'];\n            }\n            jcanvas.image(\n                ctx,\n                backgroundUrl,\n                rb.x,\n                rb.y,\n                rb.w,\n                rb.h,\n                round_radius,\n                rotation,\n                function () {\n                    node.ready = true;\n                }\n            );\n        }\n        if (!!node.topic) {\n            if (text_overflow === 'ellipsis') {\n                jcanvas.text_ellipsis(ctx, node.topic, tb.x, tb.y, tb.w, tb.h);\n            } else {\n                var line_height = parseInt(css(ncs, 'line-height'));\n                jcanvas.text_multiline(ctx, node.topic, tb.x, tb.y, tb.w, tb.h, line_height);\n            }\n        }\n        if (!!view_data.expander) {\n            this._draw_expander(view_data.expander);\n        }\n        if (!('background-image' in node.data)) {\n            node.ready = true;\n        }\n    }\n    _draw_expander(expander) {\n        var ctx = this.canvas_ctx;\n        var ncs = getComputedStyle(expander);\n        if (!is_visible(ncs)) {\n            return;\n        }\n\n        var style_left = css(ncs, 'left');\n        var style_top = css(ncs, 'top');\n        var font = css(ncs, 'font');\n        var left = parseInt(style_left);\n        var top = parseInt(style_top);\n        var is_plus = expander.innerHTML === '+';\n\n        ctx.lineWidth = 1;\n\n        ctx.beginPath();\n        ctx.arc(left + 7, top + 7, 5, 0, Math.PI * 2, true);\n        ctx.moveTo(left + 10, top + 7);\n        ctx.lineTo(left + 4, top + 7);\n        if (is_plus) {\n            ctx.moveTo(left + 7, top + 4);\n            ctx.lineTo(left + 7, top + 10);\n        }\n        ctx.closePath();\n        ctx.stroke();\n    }\n    _download() {\n        var c = this.canvas_elem;\n        var name = this.jm.mind.name + '.png';\n\n        if (navigator.msSaveBlob && !!c.msToBlob) {\n            var blob = c.msToBlob();\n            navigator.msSaveBlob(blob, name);\n        } else {\n            var bloburl = this.canvas_elem.toDataURL();\n            var anchor = $.c('a');\n            if ('download' in anchor) {\n                anchor.style.visibility = 'hidden';\n                anchor.href = bloburl;\n                anchor.download = name;\n                $.d.body.appendChild(anchor);\n                var evt = $.d.createEvent('MouseEvents');\n                evt.initEvent('click', true, true);\n                anchor.dispatchEvent(evt);\n                $.d.body.removeChild(anchor);\n            } else {\n                location.href = bloburl;\n            }\n        }\n    }\n    jm_event_handle(type, data) {\n        if (type === jsMind.event_type.resize) {\n            this.resize();\n        }\n    }\n}\n\nvar screenshot_plugin = new jsMind.plugin('screenshot', function (jm) {\n    var jss = new screenshot(jm);\n    jm.screenshot = jss;\n    jm.shoot = function () {\n        jss.shoot();\n    };\n    jm.add_event_listener(function (type, data) {\n        jss.jm_event_handle.call(jss, type, data);\n    });\n});\n\njsMind.register_plugin(screenshot_plugin);\n"],"names":["jsMind","Error","$","css","cStyle","property_name","getPropertyValue","is_visible","visibility","display","jcanvas","ctx","x","y","w","h","r","moveTo","arcTo","text","lineheight","line","text_len","length","chars","split","test_line","textAlign","textBaseline","i","measureText","width","fillText","center_y","fittingString","max_width","ellipsis_width","len","substring","url","rotation","callback","img","Image","onload","save","translate","beginPath","rect","closePath","clip","rotate","Math","PI","drawImage","restore","src","screenshot","constructor","jm","this","version","canvas_elem","canvas_ctx","_inited","init","console","log","c","getContext","view","e_panel","appendChild","resize","shoot","_draw","clean","bind","_watermark","shootDownload","_download","shootAsDataURL","toDataURL","size","height","clearRect","_draw_lines","_draw_nodes","fillStyle","font","location","graph","copy_to","node","nodes","mind","nodeid","_draw_node","check_nodes_ready","Date","allOk","ready","setTimeout","view_data","_data","node_element","element","ncs","getComputedStyle","bgcolor","round_radius","parseInt","color","padding_left","padding_right","padding_top","padding_bottom","text_overflow","rb","abs_x","abs_y","tb","fill","data","backgroundUrl","slice","image","topic","text_ellipsis","line_height","text_multiline","expander","_draw_expander","style_left","style_top","left","top","is_plus","innerHTML","lineWidth","arc","lineTo","stroke","name","navigator","msSaveBlob","msToBlob","blob","bloburl","anchor","style","href","download","d","body","evt","createEvent","initEvent","dispatchEvent","removeChild","jm_event_handle","type","event_type","screenshot_plugin","plugin","jss","add_event_listener","call","register_plugin"],"mappings":"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"}