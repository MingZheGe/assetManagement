{"version":3,"file":"index.js","sources":["../../src/ComponentTimer.ts","../../src/mixin.ts","../../src/index.ts"],"sourcesContent":["import { Vue } from 'vue/types/vue'\n\nexport type TimerState = 'created' | 'running' | 'expired' | 'stopped'\nexport default class ComponentTimer {\n  repeat = false\n  interval = 1000\n  timerId: NodeJS.Timer | number = -1\n  vm!: Vue\n  methodName: string\n  state: TimerState\n  method!: Function\n  args?: () => []\n\n  start() {\n    if (this.state === 'running' || this.state === 'expired') {\n      return\n    }\n    if (this.repeat) {\n      this.timerId = setInterval(() => {\n        this.args ? this.method(...this.args()) : this.method()\n      }, this.interval)\n      this.state = 'running'\n    } else {\n      this.timerId = setTimeout(() => {\n        this.args ? this.method(...this.args()) : this.method()\n        this.state = 'expired'\n      }, this.interval)\n      this.state = 'running'\n    }\n  }\n  stop() {\n    if (this.repeat) {\n      clearInterval(this.timerId as number)\n    } else {\n      clearTimeout(this.timerId as number)\n    }\n    this.state = 'stopped'\n  }\n\n  constructor(\n    methodName: string,\n    interval: number = 1000,\n    repeat: boolean = false,\n    args?: <V extends Vue>(this: V) => []\n  ) {\n    this.repeat = repeat\n    this.interval = interval\n    this.methodName = methodName\n    this.state = 'created'\n    this.args = args\n  }\n  setVM(vm: Vue) {\n    this.vm = vm\n    if (!(this.vm as any)[this.methodName]) {\n      throw new Error('ERR_METHOD_NOT_FOUND: Method name in timer is probably wrong')\n    }\n    this.method = ((this.vm as any)[this.methodName] as Function).bind(this.vm)\n    if (this.args) {\n      this.args = this.args.bind(this.vm)\n    }\n  }\n}\n","import { ComponentOptions } from 'vue'\nimport { Vue, VueConstructor } from 'vue/types/vue'\nimport ComponentTimer from './ComponentTimer'\nimport { VueClass } from 'vue-class-component/lib/declarations'\n\nexport default {\n  data() {\n    if (!this.$options.timers) {\n      return {}\n    } else {\n      return {\n        timers: Object.keys(this.$options.timers).map(\n          (key) =>\n            new ComponentTimer(\n              key,\n              this.$options.timers![key].interval,\n              this.$options.timers![key].repeat,\n              this.$options.timers![key].args\n            )\n        )\n      }\n    }\n  },\n  created() {\n    if (!this.timers) return\n    let vm = this as Vue\n    let timers = this.timers\n    timers.forEach((timer) => timer.setVM(vm))\n    // @ts-ignore\n    vm.$timers = {\n      start: () => {\n        timers.forEach((timer) => {\n          console.log(`start: ${timer.methodName} ${timer.state}`)\n          timer.start()\n        })\n      },\n      stop: () => {\n        timers.forEach((timer) => {\n          console.log(`stop: ${timer.methodName} ${timer.state}`)\n          timer.stop()\n        })\n      }\n    }\n  },\n  mounted() {\n    if (!this.timers) {\n      return\n    }\n    this.$timers.start()\n  },\n  beforeDestroy() {\n    if (!this.timers) {\n      return\n    }\n    this.$timers.stop()\n  }\n} as typeof Vue & Vue & ComponentOptions<Vue> & { timers: ComponentTimer[] }\n","import VC, { Vue } from 'vue/types/vue'\nimport VueTimersMixin from './mixin'\n\nexport { VueTimersMixin }\nexport { Timer } from './decorator'\n\nexport default function(Vue: VC.VueConstructor) {\n  Vue.mixin(VueTimersMixin)\n}\n\ntype DefaultTimers<V, Methods> = {\n  [key in keyof Methods]: {\n    repeat?: boolean\n    interval?: number\n    args?: (this: V) => []\n  }\n}\ndeclare module 'vue/types/options' {\n  export interface ComponentOptions<\n    V extends Vue,\n    Data = DefaultData<V>,\n    Methods = DefaultMethods<V>,\n    Computed = DefaultComputed,\n    PropsDef = PropsDefinition<DefaultProps>,\n    Props = DefaultProps\n  > {\n    timers?: DefaultTimers<V, Methods>\n  }\n}\ndeclare module 'vue/types/vue' {\n  export interface Vue {\n    readonly $timers: { start: Function; stop: Function }\n  }\n}\n"],"names":[],"mappings":"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"}