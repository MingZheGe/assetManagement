{"version":3,"file":"index.js","sources":["../../src/ComponentTimer.ts","../../src/mixin.ts","../../src/decorator.ts","../../src/index.ts"],"sourcesContent":["import { Vue } from 'vue/types/vue'\n\nexport type TimerState = 'created' | 'running' | 'expired' | 'stopped'\nexport default class ComponentTimer {\n  repeat = false\n  interval = 1000\n  timerId: NodeJS.Timer | number = -1\n  vm!: Vue\n  methodName: string\n  state: TimerState\n  method!: Function\n  args?: () => []\n\n  start() {\n    if (this.state === 'running' || this.state === 'expired') {\n      return\n    }\n    if (this.repeat) {\n      this.timerId = setInterval(() => {\n        this.args ? this.method(...this.args()) : this.method()\n      }, this.interval)\n      this.state = 'running'\n    } else {\n      this.timerId = setTimeout(() => {\n        this.args ? this.method(...this.args()) : this.method()\n        this.state = 'expired'\n      }, this.interval)\n      this.state = 'running'\n    }\n  }\n  stop() {\n    if (this.repeat) {\n      clearInterval(this.timerId as number)\n    } else {\n      clearTimeout(this.timerId as number)\n    }\n    this.state = 'stopped'\n  }\n\n  constructor(\n    methodName: string,\n    interval: number = 1000,\n    repeat: boolean = false,\n    args?: <V extends Vue>(this: V) => []\n  ) {\n    this.repeat = repeat\n    this.interval = interval\n    this.methodName = methodName\n    this.state = 'created'\n    this.args = args\n  }\n  setVM(vm: Vue) {\n    this.vm = vm\n    if (!(this.vm as any)[this.methodName]) {\n      throw new Error('ERR_METHOD_NOT_FOUND: Method name in timer is probably wrong')\n    }\n    this.method = ((this.vm as any)[this.methodName] as Function).bind(this.vm)\n    if (this.args) {\n      this.args = this.args.bind(this.vm)\n    }\n  }\n}\n","import { ComponentOptions } from 'vue'\nimport { Vue, VueConstructor } from 'vue/types/vue'\nimport ComponentTimer from './ComponentTimer'\nimport { VueClass } from 'vue-class-component/lib/declarations'\n\nexport default {\n  data() {\n    if (!this.$options.timers) {\n      return {}\n    } else {\n      return {\n        timers: Object.keys(this.$options.timers).map(\n          (key) =>\n            new ComponentTimer(\n              key,\n              this.$options.timers![key].interval,\n              this.$options.timers![key].repeat,\n              this.$options.timers![key].args\n            )\n        )\n      }\n    }\n  },\n  created() {\n    if (!this.timers) return\n    let vm = this as Vue\n    let timers = this.timers\n    timers.forEach((timer) => timer.setVM(vm))\n    // @ts-ignore\n    vm.$timers = {\n      start: () => {\n        timers.forEach((timer) => {\n          console.log(`start: ${timer.methodName} ${timer.state}`)\n          timer.start()\n        })\n      },\n      stop: () => {\n        timers.forEach((timer) => {\n          console.log(`stop: ${timer.methodName} ${timer.state}`)\n          timer.stop()\n        })\n      }\n    }\n  },\n  mounted() {\n    if (!this.timers) {\n      return\n    }\n    this.$timers.start()\n  },\n  beforeDestroy() {\n    if (!this.timers) {\n      return\n    }\n    this.$timers.stop()\n  }\n} as typeof Vue & Vue & ComponentOptions<Vue> & { timers: ComponentTimer[] }\n","import { createDecorator, VueDecorator } from 'vue-class-component'\n\nexport interface TimerDecoratorOptions {\n  interval?: number\n  repeat?: true\n  args?: () => any\n}\nlet Timer: (opt: TimerDecoratorOptions) => VueDecorator\n\nfunction timerDecorator(opt: TimerDecoratorOptions) {\n  return createDecorator((options, key) => {\n    if (!options.timers) {\n      options.timers = {}\n    }\n    options.timers[key] = {\n      interval: opt.interval || 1000,\n      repeat: opt.repeat || false,\n      args: opt.args\n    }\n  })\n}\n// @ts-ignore\nif (process.env.MODULE_FORMAT !== 'umd') {\n  Timer = timerDecorator\n}\nexport { Timer }\n","import VC, { Vue } from 'vue/types/vue'\nimport VueTimersMixin from './mixin'\n\nexport { VueTimersMixin }\nexport { Timer } from './decorator'\n\nexport default function(Vue: VC.VueConstructor) {\n  Vue.mixin(VueTimersMixin)\n}\n\ntype DefaultTimers<V, Methods> = {\n  [key in keyof Methods]: {\n    repeat?: boolean\n    interval?: number\n    args?: (this: V) => []\n  }\n}\ndeclare module 'vue/types/options' {\n  export interface ComponentOptions<\n    V extends Vue,\n    Data = DefaultData<V>,\n    Methods = DefaultMethods<V>,\n    Computed = DefaultComputed,\n    PropsDef = PropsDefinition<DefaultProps>,\n    Props = DefaultProps\n  > {\n    timers?: DefaultTimers<V, Methods>\n  }\n}\ndeclare module 'vue/types/vue' {\n  export interface Vue {\n    readonly $timers: { start: Function; stop: Function }\n  }\n}\n"],"names":["createDecorator","Timer"],"mappings":"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"}