<template>
    <div :id='ID' class="stockcdeal" ref='stockdeal' style="width:100%;height:100%">
        <div class='hqchart' id="hqchart" ref="hqchart"></div>
    </div>
</template>

<script type="text/javascript">

import $ from 'jquery'
import JSCommon from '../umychart.vue/umychart.vue.js'
import '../../jscommon/umychart.resource/font/iconfont.css'
import '../../jscommon/umychart.resource/css/tools.css'

function DefaultData()
{

}

//分钟数据默认配置
DefaultData.GetDealOption=function()
{
    const option=
    {
        Type:'成交明细',   //创建图形类型
                
        Symbol:'600000.sh',
        IsAutoUpdate:false,          //是自动更新数据
        AutoUpdateFrequency:3000,   //数据更新频率

        Column:
        [
            {Type:JSCommon.DEAL_COLUMN_ID.TIME_ID },
            {Type:JSCommon.DEAL_COLUMN_ID.PRICE_ID },
            {Type:JSCommon.DEAL_COLUMN_ID.UPDOWN_ID },
            {Type:JSCommon.DEAL_COLUMN_ID.VOL_ID },
            {Type:JSCommon.DEAL_COLUMN_ID.BS_ID },
            
        ],
        
        Border: //边框
        {
            Left:5,         //左边间距
            Right:5,       //右边间距
            Bottom:5,      //底部间距
            Top:5          //顶部间距
        }
    };

    return option;
}

function ObjectHelper()
{

}

ObjectHelper.IsObjectExist=JSCommon.IFrameSplitOperator.IsObjectExist;  //字段是否存在
ObjectHelper.IsNumber=JSCommon.IFrameSplitOperator.IsNumber;            //是否是数组
ObjectHelper.IsPlusNumber=JSCommon.IFrameSplitOperator.IsPlusNumber;    //是否是正数


export default 
{
    name:'StockDeal',
    //外部传入的参数
    props: 
    [
        'DefaultSymbol',     //默认股票
        'DefaultOption',     //设置
        'DefaultStyle',
        'DefaultAPIDomain',  //数据API域名设置
    ],

    data()
    {
        let data=
        { 
            Symbol:'600000.sh', //股票
            ID:JSCommon.JSChart.CreateGuid(),
            JSChart:null,   //图形控件
            Option:DefaultData.GetDealOption(),   //设置
        }

        return data;
    },

    created:function()
    {
        //处理默认传入的参数
        if (this.DefaultSymbol) this.Symbol=this.DefaultSymbol; //默认股票
        if(this.DefaultStyle) this.JSchartStyle = this.DefaultStyle;
        if (this.DefaultOption) this.SetOption(this.DefaultOption);
        if (this.DefaultAPIDomain) 
        {
            JSCommon.JSChart.SetDomain(this.DefaultAPIDomain.Domain,this.DefaultAPIDomain.CacheDomain);
            JSCommon.JSComplier.SetDomain(this.DefaultAPIDomain.Domain,this.DefaultAPIDomain.CacheDomain);
        }
    },

    mounted:function()
    {
        console.log(`[StockDeal::mounted]`);
        this.OnSize();                      //子组件的mounted在父组件的mounted之前执行了
        this.CreateJSChart();
        console.log('[StockDeal::mounted] end.');
    },

    methods:
    {
        //内部方法
        SetOption:function(option)
        {
           
        },

        SetBorderOption:function(option)    //设置属性 Border,
        {
            if (!option.Border) return;
            
            let border=option.Border;
            if (ObjectHelper.IsNumber(border.Left)) this.Option.Border.Left=border.Left;    
            if (ObjectHelper.IsNumber(border.Right)) this.Option.Border.Right=border.Right;    
            if (ObjectHelper.IsNumber(border.Top)) this.Option.Border.Top=border.Top;    
            if (ObjectHelper.IsNumber(border.Bottom)) this.Option.Border.Left=border.Bottom;    
        },

        //创建图
        CreateJSChart:function()
        {
            if (this.JSChart) return;
            this.Option.Symbol=this.Symbol;

            if(this.JSchartStyle) 
            {
                var resource=JSCommon.HQChartStyle.GetStyleConfig(JSCommon.STYLE_TYPE_ID.BLACK_ID);
                JSCommon.JSChart.SetStyle(resource);  //设置图形样式

                var clrBG="rgb(0,0,0)";
                var div=this.$refs.stockdeal;
                div.style.backgroundColor=clrBG;
            }
            
            let chart=JSCommon.JSDealChart.Init(this.$refs.hqchart);
            chart.SetOption(this.Option);
            this.JSChart=chart;
        },


        //对外接口

        //大小调整
        OnSize:function()
        { 
            var stockdeal=this.$refs.stockdeal;
            var height= stockdeal.offsetHeight-5;
            var width = stockdeal.offsetWidth-5;
            console.log(`[StockDeal::OnSize] width=${width} height=${height}`); 

            var divChart=this.$refs.hqchart;
            divChart.style.width=width+'px';
            divChart.style.height=height+'px';

            if (this.JSChart && height>0 && width>0) this.JSChart.OnSize();
        },

        //切换股票代码
        ChangeSymbol:function(symbol)
        {
            if (this.Symbol==symbol) return;

            this.Symbol=symbol;
            if (this.JSChart) this.JSChart.ChangeSymbol(this.Symbol);
        },

        GetDefaultDealOption:function()
        {
            return DefaultData.GetDealOption()
        }
    }
}
</script>


<style scoped lang="less">

.hqchart
{
    left:0px;
    top:0px;
    position: relative;
    width:100%;
    height:100%;
}

</style>